@using Alma.Workflows.Core.Abstractions
@using Alma.Workflows.Core.Description.Descriptors
@using Alma.Workflows.Definitions
@using Alma.Workflows.Extensions
@using MudBlazor
@using Alma.Core.Extensions

<MudSwitch Label="@Parameter.DisplayName" 
           Value="@bool.Parse(Parameterizable.GetParameterValue(Parameter.Name).IsNullOrEmpty("false"))"
           ValueChanged="@((bool e) => HandleValueChanged(e.ToString()))"
           Color="Color.Primary"
           Class="mb-2"
           Style="width: max-content;" />

@code {
    [Parameter]
    public IParameterizableDefinition Parameterizable { get; set; } = null!;

    [Parameter]
    public ParameterDescriptor Parameter { get; set; } = null!;

    [Parameter]
    public EventCallback<ParameterDefinition> ParameterChanged { get; set; }

    [Parameter]
    public bool Disabled { get; set; }

    private async Task HandleValueChanged(string value)
    {
        Parameterizable.SetParameterValue(Parameter, value);

        var definition = Parameterizable.GetParameterDefinition(Parameter.Name);

        await ParameterChanged.InvokeAsync(definition);
    }
}
